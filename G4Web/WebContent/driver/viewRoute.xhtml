<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<link rel="stylesheet"
		href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
	<h:form method="post" id="homeform">
		<h:commandButton value="Home" class="btn btn-primary pull-left"
			action="#{userController.goToIndexD()}"
			style="float: left;text-decoration:none; padding:5px;" />
	</h:form>
	<title><ui:insert name="title">Route view</ui:insert></title>
	<meta name="viewport" content="initial-scale=1.0" />
	<meta charset="utf-8" />
	<style>
.mapinv {
	display: none;
}
/* Always set the map height explicitly to define the size of the div
 * element that contains the map. */
#map {
	height: 100%;
	width: 100%;
}

.mapinv {
	display: none;
}
</style>
	<meta name="viewport" content="initial-scale=1.0" />
	<meta charset="utf-8" />
	<f:metadata>
		<f:viewParam name="route" value="#{routeController.route.id}" />
		<f:viewAction action="#{routeController.findRoute}" />
	</f:metadata>
</h:head>

<h:body>

	<div class="jumbotron jumbotron-sm">
		<div class="container">
			<div class="row">
				<div class="col-sm-12 col-lg-12">

					<h1 class="h1">
						Route to: #{routeController.route.eindpunt} <small></small>
					</h1>

				</div>
			</div>
		</div>
	</div>
	<br />


	<div align='center' class="container">
		<div class="row">
			<div class="col-md-8">
				<div class="well well-sm">
					<div style="margin: 0 auto; width: 600px; height: 600px;" id="map"></div>
					<h2>Laatste aankomsttijd: #{routeController.route.eindtijd}</h2>
					<h2>Aantal vrije zitplaatsen:
						#{routeController.route.maxPersonen}</h2>
					<br />
					<div align='center'>
						<h:outputLabel value="Vertrek Adres: " />
						<input required="required" id="vertrekAdress" type="text" />
						<h:inputHidden id="pleaseGodWork" value="text" />
					</div>
					<br />
					<button onclick="document.getElementById('pleaseGodWork').value">Check
						me 2</button>
					<button onclick="DistanceCalc(), markerMap()">Check me</button>
					<div align='center'>
						<h:form method="post" id="requestform">
							<h:commandButton value="Verstuur verzoek" class="btn btn-primary"
								action="#{routeController.requestRit(routeController.route.id)}"
								style="margin: 0 auto;text-decoration:none; padding:5px;" />
						</h:form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUI3IbCN38MjQJgCJptMXN4NluM7EdHns&amp;libraries=places,geometry&amp;callback=PlaceAutocompleteSearch&amp;fields=formatted_address&amp;callback=initMap"
		async="" defer=""></script>


	<script>

      function initMap() {
        var directionsService = new google.maps.DirectionsService;
        var directionsRenderer = new google.maps.DirectionsRenderer;
        let map = new google.maps.Map(document.getElementById('map'), {
          zoom: 6,
          center: {lat: 51.051410, lng: 3.726115}
        });
        directionsRenderer.setMap(map);
        
		
      
          calculateAndDisplayRoute(directionsService, directionsRenderer);
          PlaceAutocompleteSearch();
      }
	  function DistanceCalc(){
		  var originA = "#{routeController.route.beginpunt}";
		  var destA = "#{routeController.route.eindpunt}";
		  var destT = document.getElementById('pleaseGodWork').value;
		  var originT = destT;
		 
		  var destinationIcon = 'https://chart.googleapis.com/chart?chst=d_map_pin_letter&amp;chld=D|FF0000|000000';
	 	 var originIcon = 'https://chart.googleapis.com/chart?chst=d_map_pin_letter&amp;chld=O|FFFF00|000000';
		  
		 
		  var service = new google.maps.DistanceMatrixService;
		  service.getDistanceMatrix({
			    origins: [originA, originT],
			    destinations: [destA, destT],
			    travelMode: 'DRIVING',
			    unitSystem: google.maps.UnitSystem.METRIC,
			    avoidHighways: false,
			    avoidTolls: false
			  }, function(response, status) {
			    if (status !== 'OK') {
			      alert('Error was: ' + status);
			    } else {
			      var originList = response.originAddresses;
			      var destinationList = response.destinationAddresses;
			    /*   var outputDiv = document.getElementById('output');
			      outputDiv.innerHTML = '';
			      deleteMarkers(markersArray);
 */
				

				var totalDuration = 0;
				/* for (var i = 0; i &lt; originList.length; i++) {
				  var results = response.rows[i].elements;
				  geocoder.geocode({'address': originList[i]},
				      showGeocodedAddressOnMap(false));
				  for (var j = 0; j &lt; results.length; j++) {
				    geocoder.geocode({'address': destinationList[j]},
				        showGeocodedAddressOnMap(true));
				    outputDiv.innerHTML += originList[i] + ' to ' + destinationList[j] +
				        ': ' + results[j].distance.text + ' in ' +
				        results[j].duration.text + '<br />';
				  }
				} */
				var resultAT = response.rows[0].elements[1].duration.value;

				console.log(resultAT);
				var resultTD = response.rows[1].elements[0].duration.value;
				console.log(resultTD);
				totalDuration = resultAT + resultTD;
				console.log("Totale tijd in sec voor de route met omweg: "
						+ totalDuration);
			}
		});

	}
	function calculateAndDisplayRoute(directionsService, directionsRenderer) {

		var waypts = [];
		/* var checkboxArray = document.getElementById('waypoints');
		for (var i = 0; i &lt; checkboxArray.length; i++) {
		  if (checkboxArray.options[i].selected) {
		    waypts.push({
		      location: checkboxArray[i].value,
		      stopover: true
		    });
		  }
		} */

		directionsService.route({
			origin : "#{routeController.route.beginpunt}",
			destination : "#{routeController.route.eindpunt}",
			waypoints : waypts,
			optimizeWaypoints : true,
			travelMode : 'DRIVING'
		}, function(response, status) {
			if (status === 'OK') {
				directionsRenderer.setDirections(response);
				var route = response.routes[0];
				/*var summaryPanel = document.getElementById('directions-panel');
				summaryPanel.innerHTML = '';
				// For each route, display summary information.
				 for (var i = 0; i &lt; route.legs.length; i++) {
				  var routeSegment = i + 1;
				  summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment +
				      '</b><br />';
				  summaryPanel.innerHTML += route.legs[i].start_address + ' to ';
				  summaryPanel.innerHTML += route.legs[i].end_address + '<br />';
				  summaryPanel.innerHTML += route.legs[i].distance.text + '<br /><br />';
				} */
			} else {
				window.alert('Directions request failed due to ' + status);
			}
		});
	}
	function PlaceAutocompleteSearch() {

		var options = {
			types : [ 'address' ]
		};
		var componentForm = {
			street_number : 'short_name',
			route : 'long_name',
			locality : 'long_name',
			administrative_area_level_1 : 'short_name',
			country : 'long_name',
			postal_code : 'short_name'
		};
		var input = document.getElementById('vertrekAdress');
		var autocomplete = new google.maps.places.Autocomplete(input, options);
		var place = autocomplete.getPlace();
		autocomplete.addListener('place_changed', fillInAddress);
		/*   document.getElementById('viewRoute:pleaseGodWork').value = place.formatted_address; */
		console.log(document.getElementById('viewRoute:pleaseGodWork').value)

		function fillInAddress() {
			// Get the place details from the autocomplete object.
			var place = autocomplete.getPlace();
			console.log(place);

			document.getElementById('pleaseGodWork').value = place.formatted_address;
			
		}

	}
	
	function markerMap(){
		var geocoder = new google.maps.Geocoder;
		geocoder.geocode( { 'address': document.getElementById('pleaseGodWork').value}, function(results, status) {
			console.log("test");
				if (status == 'OK') {
					console.log(results[0].geometry.location);
					var latlng = {lat: results[0].geometry.location.lat(), lng: results[0].geometry.location.lng()};
					console.log(latlng);
			  		 var marker = new google.maps.Marker({
						    map: document.getElementById('map').value,
						    position: latlng
			    		});
			  		 marker.setMap(document.getElementById('map').value);
			  		 
			    } else {
	       alert('Geocode was not successful for the following reason: ' + status);
				}
		});
	}
</script>

</h:body>
</html>
